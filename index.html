<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="title" content="colour colour colour" />
    <meta name="description" content="A random colour generator" />

    <title>colour colour colour</title>

    <style>
      body {
        align-items: center;
        background-color: rgb(242, 190, 209);
        color: rgb(0, 0, 0);
        display: flex;
        flex-direction: column;
        height: 100dvh;
        justify-content: center;
        margin: 0;
        user-select: none;
      }

      main {
        display: flex;
        flex: 1;
        flex-direction: column;
        justify-content: center;
        padding: 1rem;
      }

      div {
        align-items: center;
        display: flex;
        gap: 1rem;
        justify-content: center;
      }

      div:not(:last-child) {
        margin-bottom: 1.5rem;
      }

      button {
        font-size: 1rem;
        line-height: 1.5rem;
      }

      main p {
        font-size: 1.5rem;
      }

      p {
        cursor: default;
        margin: 0;
      }

      footer {
        flex: 0.2;
      }

      footer p {
        text-align: center;
      }

      footer p:not(:last-child) {
        margin-bottom: 0.5rem;
      }

      a {
        color: inherit;
      }
    </style>
    <script>
      function randomRgbComponent() {
        return Math.floor(Math.random() * 256);
      }

      function randomRgb() {
        return [...Array(3)].map(randomRgbComponent);
      }

      function styleFromRgb(rgb) {
        return `rgb(${rgb.join(", ")})`;
      }

      function hexStyleFromRgb(rgb) {
        const hexComponents = rgb.map((component) =>
          component.toString(16).padStart(2, "0"),
        );
        return `#${hexComponents.join("")}`;
      }

      function luminance(rgb) {
        const [rLuminance, gLuminance, bLuminance] = rgb.map((component) => {
          const sRgbComponent = component / 255.0;
          return sRgbComponent <= 0.04045
            ? sRgbComponent / 12.92
            : Math.pow((sRgbComponent + 0.055) / 1.055, 2.4);
        });
        return 0.2126 * rLuminance + 0.7152 * gLuminance + 0.0722 * bLuminance;
      }

      function maxContrastRgb(rgb) {
        const rgbLuminance = luminance(rgb);
        const blackLuminance = 0.0;
        const whiteLuminance = 1.0;

        const blackContrast = (rgbLuminance + 0.05) / (blackLuminance + 0.05);
        const whiteContrast = (whiteLuminance + 0.05) / (rgbLuminance + 0.05);

        return blackContrast > whiteContrast ? [0, 0, 0] : [255, 255, 255];
      }

      function updateFavicon(rgbStyle) {
        const favicon = new Image();
        favicon.src = "";
        const canvas = document.createElement("canvas");
        canvas.width = 32;
        canvas.height = 32;
        const context = canvas.getContext("2d");
        context.drawImage(favicon, 0, 0);
        context.fillStyle = rgbStyle;
        context.fillRect(0, 0, 32, 32);
        const linkMetaTag =
          document.querySelector("link[rel*='icon']") ||
          document.createElement("link");
        linkMetaTag.type = "image/x-icon";
        linkMetaTag.rel = "shortcut icon";
        linkMetaTag.href = canvas.toDataURL("image/x-icon");
        document.querySelector("head").appendChild(linkMetaTag);
      }

      function changeColour(event) {
        if (event.target.nodeName === "BUTTON") return;

        const backgroundRgb = randomRgb();
        const backgroundRgbStyle = styleFromRgb(backgroundRgb);
        const maxContrastRgbStyle = styleFromRgb(maxContrastRgb(backgroundRgb));
        document.body.style.backgroundColor = backgroundRgbStyle;
        document.body.style.color = maxContrastRgbStyle;
        document.querySelector("#rgb p").innerText = backgroundRgbStyle;
        document.querySelector("#hex p").innerText =
          hexStyleFromRgb(backgroundRgb);
        updateFavicon(backgroundRgbStyle);
      }

      function copyCode(event) {
        const code = event.target.parentNode.querySelector("p").innerText;
        navigator.clipboard.writeText(code);
      }
    </script>
  </head>
  <body>
    <main>
      <div id="rgb">
        <p>rgb(242, 190, 209)</p>
        <button onclick="copyCode(event)">copy RGB</button>
      </div>
      <div id="hex">
        <p>#f2bed1</p>
        <button onclick="copyCode(event)">copy hex</button>
      </div>
    </main>
    <footer>
      <p>click (almost) anywhere or press space to randomise</p>
      <p>(hold to party)</p>
      <p>~</p>
      <p><a href="https://github.com/yndajas/colour">source code</a></p>
    </footer>
    <script>
      updateFavicon("rgb(242, 190, 209");

      document.addEventListener("keydown", function (event) {
        if (event.code === "Space") {
          changeColour(event);
        }
      });

      for (const { start, end } of [
        { start: "mousedown", end: "mouseup" },
        { start: "touchstart", end: "touchend" },
      ]) {
        document.addEventListener(start, function (event) {
          changeColour(event);
          const timeout = setTimeout(function () {
            const interval = setInterval(function () {
              changeColour(event);
            }, 100);
            document.addEventListener(end, function (event) {
              clearInterval(interval);
            });
          }, 400);
          document.addEventListener(end, function (event) {
            clearTimeout(timeout);
          });
        });
      }
    </script>
  </body>
</html>

